"use strict";(self.webpackChunkpaima_engine_docs=self.webpackChunkpaima_engine_docs||[]).push([[5650],{8496:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>d,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>r,toc:()=>l});var n=t(5893),s=t(1151);const i={},o="Data Migrations",r={id:"home/database-management/migrations",title:"Data Migrations",description:"Data Migrations allow game developers to add data to the database e.g., World Setup, NPC, Items, and other system tables.",source:"@site/docs/home/500-database-management/400-migrations.md",sourceDirName:"home/500-database-management",slug:"/home/database-management/migrations",permalink:"/home/database-management/migrations",draft:!1,unlisted:!1,editUrl:"https://github.com/PaimaStudios/paima-engine-docs/docs/home/500-database-management/400-migrations.md",tags:[],version:"current",sidebarPosition:400,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Database Snapshotting",permalink:"/home/database-management/snapshotting"},next:{title:"Updating Typescript Bindings",permalink:"/home/database-management/ts-bindings"}},d={},l=[];function c(e){const a={a:"a",br:"br",code:"code",em:"em",h1:"h1",p:"p",pre:"pre",...(0,s.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a.h1,{id:"data-migrations",children:"Data Migrations"}),"\n",(0,n.jsx)(a.p,{children:"Data Migrations allow game developers to add data to the database e.g., World Setup, NPC, Items, and other system tables."}),"\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.em,{children:"IMPORTANT"}),": You should never add data to the database manually. It should be done only through state-transitions and data migrations."]}),"\n",(0,n.jsxs)(a.p,{children:["Data Migrations are applied at a specific block-height. The file name indicates the ",(0,n.jsx)(a.code,{children:"OFFSET"})," from the ",(0,n.jsx)(a.code,{children:"START_BLOCKHEIGHT"})," (defined in the .env file - see ",(0,n.jsx)(a.a,{href:"/home/setup/environment-config-values",children:"here"}),")."]}),"\n",(0,n.jsx)(a.p,{children:"File structure:"}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{children:"root_folder\n   | --- paima-engine-{linux|macos}\n   | --- packaged\n             | --- endpoints.cjs\n             | --- gameCode.cjs\n             | --- migrations\n                          | --- 1000.sql\n                          | --- 5500.sql\n"})}),"\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.code,{children:"1000.sql"})," will be applied at block-height ",(0,n.jsx)(a.code,{children:"START_BLOCKHEIGHT + 1000"}),".",(0,n.jsx)(a.br,{}),"\n",(0,n.jsx)(a.code,{children:"5500.sql"})," will be applied at block-height ",(0,n.jsx)(a.code,{children:"START_BLOCKHEIGHT + 5500"}),".",(0,n.jsx)(a.br,{}),"\n","Both will be applied before any other inputs are processed for that block-height."]}),"\n",(0,n.jsx)(a.p,{children:"The *.sql files are PGSQL scripts. SQL scripts are automatically ran as transactions, if they fail the block-process-loop will stop and the script must be fixed and will be reapplied."}),"\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.code,{children:"1000.sql"})," example:"]}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-sql",children:"INSERT INTO items (name) VALUES ('potion') ;\nINSERT INTO items (name) VALUES ('book') ;\n"})})]})}function m(e={}){const{wrapper:a}={...(0,s.a)(),...e.components};return a?(0,n.jsx)(a,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},1151:(e,a,t)=>{t.d(a,{Z:()=>r,a:()=>o});var n=t(7294);const s={},i=n.createContext(s);function o(e){const a=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function r(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),n.createElement(i.Provider,{value:a},e.children)}}}]);