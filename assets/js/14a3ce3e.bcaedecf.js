"use strict";(self.webpackChunkpaima_engine_docs=self.webpackChunkpaima_engine_docs||[]).push([[4425],{1356:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>h,toc:()=>r});var n=a(5893),s=a(1151);const o={},i="Database Snapshotting",h={id:"home/database-management/snapshotting",title:"Database Snapshotting",description:"Paima will periodically generate local snapshots of the database. This is useful for two main cases:",source:"@site/docs/home/500-database-management/300-snapshotting.md",sourceDirName:"home/500-database-management",slug:"/home/database-management/snapshotting",permalink:"/home/database-management/snapshotting",draft:!1,unlisted:!1,editUrl:"https://github.com/PaimaStudios/paima-engine-docs/tree/main/docs/home/500-database-management/300-snapshotting.md",tags:[],version:"current",sidebarPosition:300,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Setting Up Database",permalink:"/home/database-management/setup"},next:{title:"Data Migrations",permalink:"/home/database-management/migrations"}},l={},r=[{value:"Snapshots Storage &amp; Scheduling",id:"snapshots-storage--scheduling",level:2},{value:"Snapshot Creation",id:"snapshot-creation",level:2},{value:"Snapshot Deletion",id:"snapshot-deletion",level:2}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",...(0,s.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"database-snapshotting",children:"Database Snapshotting"}),"\n",(0,n.jsx)(t.p,{children:"Paima will periodically generate local snapshots of the database. This is useful for two main cases:"}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsx)(t.li,{children:"Restoring the database in case a bug causes it to get into a bad state"}),"\n",(0,n.jsx)(t.li,{children:"Bootstrapping new deployments of a game quickly"}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"snapshots-storage--scheduling",children:"Snapshots Storage & Scheduling"}),"\n",(0,n.jsxs)(t.p,{children:["Paima Engine Runtime will automatically create/use a ",(0,n.jsx)(t.code,{children:"snapshots"})," folder. On startup, the runtime will check the snapshots folder and note the block height when the last snapshot was taken (by reading the file names, which are following the ",(0,n.jsx)(t.code,{children:"paima-snapshot-X"})," standard, where ",(0,n.jsx)(t.code,{children:"X"})," is the block height that the snapshot was taken at). If no snapshot exists, then a snapshot is created at that point."]}),"\n",(0,n.jsxs)(t.p,{children:["Snapshots are made based on the latest block height stored in the game's state machine. Notably, snapshots are made every ",(0,n.jsx)(t.code,{children:"21600"})," blocks AFTER the state machine has been updated for that block number."]}),"\n",(0,n.jsx)(t.h2,{id:"snapshot-creation",children:"Snapshot Creation"}),"\n",(0,n.jsxs)(t.p,{children:["Paima uses ",(0,n.jsx)(t.a,{href:"https://www.postgresql.org/docs/current/app-pgdump.html",children:"pg_dump"})," to create the snapshots (typically included in the postgres package of your OS)because it makes consistent backups even if the database is being used concurrently."]}),"\n",(0,n.jsxs)(t.p,{children:["If ",(0,n.jsx)(t.code,{children:"pg_dump"})," is not available, then when you start your game node an error will be printed in the terminal denoting of such, however the game node will still function perfectly fine nonetheless (and will simply skip taking snapshots)."]}),"\n",(0,n.jsx)(t.p,{children:"Paima does not do any compression of the dump by itself, so if you want to compress the archive you will need to do that yourself."}),"\n",(0,n.jsx)(t.h2,{id:"snapshot-deletion",children:"Snapshot Deletion"}),"\n",(0,n.jsx)(t.p,{children:"Paima will only keep 2 snapshots of your node. That is to say, when a new snapshot is created, the runtime checks how many snapshots exist in the folder. If there are 3, then the oldest snapshot is deleted."})]})}function c(e={}){const{wrapper:t}={...(0,s.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},1151:(e,t,a)=>{a.d(t,{Z:()=>h,a:()=>i});var n=a(7294);const s={},o=n.createContext(s);function i(e){const t=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function h(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),n.createElement(o.Provider,{value:t},e.children)}}}]);