<!doctype html>
<html lang="ja" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-home/react-to-events/funnel-types/parallel-evm-funnel" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.0">
<title data-rh="true">Parallel EVM funnel | Paima Engine</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.paimastudios.com/ja/img/paima-banner.png"><meta data-rh="true" name="twitter:image" content="https://docs.paimastudios.com/ja/img/paima-banner.png"><meta data-rh="true" property="og:url" content="https://docs.paimastudios.com/ja/home/react-to-events/funnel-types/parallel-evm-funnel"><meta data-rh="true" property="og:locale" content="ja"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Parallel EVM funnel | Paima Engine"><meta data-rh="true" name="description" content="This funnel processes the same primitives as the block funnel,"><meta data-rh="true" property="og:description" content="This funnel processes the same primitives as the block funnel,"><link data-rh="true" rel="icon" href="/ja/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.paimastudios.com/ja/home/react-to-events/funnel-types/parallel-evm-funnel"><link data-rh="true" rel="alternate" href="https://docs.paimastudios.com/home/react-to-events/funnel-types/parallel-evm-funnel" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.paimastudios.com/ja/home/react-to-events/funnel-types/parallel-evm-funnel" hreflang="ja"><link data-rh="true" rel="alternate" href="https://docs.paimastudios.com/home/react-to-events/funnel-types/parallel-evm-funnel" hreflang="x-default"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"><link rel="stylesheet" href="/ja/assets/css/styles.cfb1191c.css">
<script src="/ja/assets/js/runtime~main.6e6890ba.js" defer="defer"></script>
<script src="/ja/assets/js/main.98e0ce74.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="メインコンテンツまでスキップ"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">メインコンテンツまでスキップ</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/ja/"><div class="navbar__logo"><img src="/ja/img/favicon.ico" alt="Paima logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/ja/img/favicon.ico" alt="Paima logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Paima</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>Japanese</a><ul class="dropdown__menu"><li><a href="/home/react-to-events/funnel-types/parallel-evm-funnel" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/ja/home/react-to-events/funnel-types/parallel-evm-funnel" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="ja">Japanese</a></li></ul></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="先頭へ戻る" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Intro</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ja/">What is Paima Engine?</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/ja/home/setup/how-to-use-paima-engine">Setting-up Your Environment</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/ja/home/smart-contracts/evm/introduction">Smart Contracts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/ja/home/read-write-L2-state/base-format">Read &amp; Write L2 State</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/ja/home/react-to-events/scheduled-events">Reacting To Events</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ja/home/react-to-events/scheduled-events">Scheduling Events and Timers</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ja/home/react-to-events/primitive-catalogue/introduction">Primitive Catalogue</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ja/home/react-to-events/L2-quirks">L2 Quirks</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/ja/home/react-to-events/funnel-types/common-concepts/intro">Funnel Types</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ja/home/react-to-events/funnel-types/common-concepts/intro">Common concepts</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ja/home/react-to-events/funnel-types/configuration">Configuring your Funnel</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ja/home/react-to-events/funnel-types/block-funnel">Block Funnel</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ja/home/react-to-events/funnel-types/stable-tick-rate-funnel">Emulated Block Funnel (Stable Ticks)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ja/home/react-to-events/funnel-types/carp-funnel">Carp Funnel</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/ja/home/react-to-events/funnel-types/parallel-evm-funnel">Parallel EVM funnel</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ja/home/react-to-events/funnel-types/mina-funnel">Mina funnel</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/ja/home/game-node-api/introduction">Game Node API</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/ja/home/randomness/">Randomness</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/ja/home/database-management/introduction">Database Management</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/ja/home/releasing-a-game/generate-build">Releasing a Game</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/ja/home/multichain-support/nfts/introduction">Multichain Support</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/ja/home/libraries/evm-contracts/introduction">Libraries</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/ja/home/PRCs/prc-1">PRCs</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="https://github.com/PaimaStudios/paima-game-templates" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK">Paima Game Templates<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="https://github.com/PaimaStudios/paima-engine/" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK">Paima Engine Code<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="https://paimastudios.com" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK">Paima Studios Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">このページの見出し</button></div><div class="theme-doc-markdown markdown"><h1>Parallel EVM funnel</h1>
<p>This funnel processes the same primitives as the <a href="/ja/home/react-to-events/funnel-types/block-funnel">block funnel</a>,
but over extra companion networks. While there can only be a single instance of
the block funnel, which is associated to the instance of the Paima L2 contract,
an instance of this funnel gets instantiated for every extra network.</p>
<p>Support for parallel chains allows the game node to update based on events in different networks by actively monitoring them (instead of relying on a bridge).
For example, this allows you to have your game settle user transactions to a cheap &amp; faster chain (&quot;main chain&quot;) while having NFTs for the game live on a separate layer that has higher liquidity and more dApps to compose with.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conceptually">Conceptually<a href="#conceptually" class="hash-link" aria-label="Conceptually への直接リンク" title="Conceptually への直接リンク">​</a></h2>
<p>This funnel has the following steps:</p>
<ol>
<li>Fetch blocks &amp; timestamps from the underlying funnel (the main chain you are syncing).</li>
<li>Fetch the latest block from the parallel funnel.</li>
<li>Use <code>eth_getLogs</code> to get the <a href="/ja/home/react-to-events/primitive-catalogue/introduction">primitives</a> configured to this funnel in the block range.</li>
<li>Merge the primitives fetched from the parallel funnel with the block from the underlying funnel.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="connecting-to-networks-that-produce-blocks-on-demand">Connecting to networks that produce blocks on-demand<a href="#connecting-to-networks-that-produce-blocks-on-demand" class="hash-link" aria-label="Connecting to networks that produce blocks on-demand への直接リンク" title="Connecting to networks that produce blocks on-demand への直接リンク">​</a></h3>
<p>Some networks only produce blocks if there are actually transactions on the network (otherwise, nothing happens) such as Arbitrum.
This can be problematic for parallel funnels because it makes it hard to differentiate between a block that hasn&#x27;t been fetched yet and the case where there simply is no block for that time interval.</p>
<p>The <a href="/ja/home/react-to-events/funnel-types/stable-tick-rate-funnel">emulated block funnel</a> can help mitigate this as it forces an empty block to be made if there hasn&#x27;t been any block in a while</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="connecting-to-networks-with-slow-blocks">Connecting to networks with slow blocks<a href="#connecting-to-networks-with-slow-blocks" class="hash-link" aria-label="Connecting to networks with slow blocks への直接リンク" title="Connecting to networks with slow blocks への直接リンク">​</a></h3>
<p>Many networks such as Ethereum L1 have relatively slow block times. This can be
mitigated by relying on a <a href="/ja/home/react-to-events/funnel-types/additional-networks#delayed-state">delayed state</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="finding-parallel-chain-blocks">Finding parallel chain blocks<a href="#finding-parallel-chain-blocks" class="hash-link" aria-label="Finding parallel chain blocks への直接リンク" title="Finding parallel chain blocks への直接リンク">​</a></h2>
<p>We want to find blocks in a parallel chain that matches a timestamp range in the main chain.
However, unfortunately there is no way to use <code>eth_getLogs</code> with a timestamp range,
so the funnel actually has to find out the block height range.</p>
<p>We achieve this in 2 steps:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-find-key-blocks-during-startup-with-binary-search">1) Find key blocks during startup with binary search<a href="#1-find-key-blocks-during-startup-with-binary-search" class="hash-link" aria-label="1) Find key blocks during startup with binary search への直接リンク" title="1) Find key blocks during startup with binary search への直接リンク">​</a></h3>
<p>When booting up Paima Engine, there are 2 blocks we are interested in knowing:</p>
<ol>
<li>When the <a href="/ja/home/react-to-events/funnel-types/common-concepts/intro#readpresyncdata-function">presync</a> ends (the last block in the parallel chain that appears before the main chain starting block height)</li>
<li>The earliest parallel chain block that whose events might be included in the next main chain block we have to sync</li>
</ol>
<p>Syncing blocks one-by-one until we find these points would be too slow.
To solve this, we instead use <a href="https://simple.wikipedia.org/wiki/Binary_search" target="_blank" rel="noopener noreferrer">binary search</a> to find and cache these blocks on boot.</p>
<center><img src="data:image/png;base64,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"><p><em>Fig</em>: A binary search looking for the block with a timestamp of 4</p></center>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-fetching-blocks-in-chunks">2) Fetching blocks in chunks<a href="#2-fetching-blocks-in-chunks" class="hash-link" aria-label="2) Fetching blocks in chunks への直接リンク" title="2) Fetching blocks in chunks への直接リンク">​</a></h3>
<p>During presync, we fetch parallel chain events in batches defined by <a href="/ja/home/react-to-events/funnel-types/configuration">presyncStepSize</a>.</p>
<p>After presync, we fetch parallel chain blocks in chunks of <a href="/ja/home/react-to-events/funnel-types/configuration">funnelBlockGroupSize</a>.
We keep doing this until we have a block with a timestamp greater than the latest one we&#x27;ve seen from the main chain.
This allows us to know how to map the parallel chain block number of any event we find to the right block in the main chain.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/PaimaStudios/paima-engine-docs/tree/main/docs/home/300-react-to-events/3-funnel-types/500-parallel-evm-funnel.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>このページを編集</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ドキュメントページ"><a class="pagination-nav__link pagination-nav__link--prev" href="/ja/home/react-to-events/funnel-types/carp-funnel"><div class="pagination-nav__sublabel">前へ</div><div class="pagination-nav__label">Carp Funnel</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/ja/home/react-to-events/funnel-types/mina-funnel"><div class="pagination-nav__sublabel">次へ</div><div class="pagination-nav__label">Mina funnel</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#conceptually" class="table-of-contents__link toc-highlight">Conceptually</a><ul><li><a href="#connecting-to-networks-that-produce-blocks-on-demand" class="table-of-contents__link toc-highlight">Connecting to networks that produce blocks on-demand</a></li><li><a href="#connecting-to-networks-with-slow-blocks" class="table-of-contents__link toc-highlight">Connecting to networks with slow blocks</a></li></ul></li><li><a href="#finding-parallel-chain-blocks" class="table-of-contents__link toc-highlight">Finding parallel chain blocks</a><ul><li><a href="#1-find-key-blocks-during-startup-with-binary-search" class="table-of-contents__link toc-highlight">1) Find key blocks during startup with binary search</a></li><li><a href="#2-fetching-blocks-in-chunks" class="table-of-contents__link toc-highlight">2) Fetching blocks in chunks</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Paima Studios. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>