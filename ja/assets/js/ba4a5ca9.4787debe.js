"use strict";(self.webpackChunkpaima_engine_docs=self.webpackChunkpaima_engine_docs||[]).push([[5650],{8496:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>d,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>r,toc:()=>c});var t=n(5893),s=n(1151);const i={},o="Data Migrations",r={id:"home/database-management/migrations",title:"Data Migrations",description:"Data Migrations allow game developers to add data to the database e.g., World Setup, NPC, Items, and other system tables.",source:"@site/docs/home/500-database-management/400-migrations.md",sourceDirName:"home/500-database-management",slug:"/home/database-management/migrations",permalink:"/ja/home/database-management/migrations",draft:!1,unlisted:!1,editUrl:"https://github.com/PaimaStudios/paima-engine-docs/docs/home/500-database-management/400-migrations.md",tags:[],version:"current",sidebarPosition:400,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Database Snapshotting",permalink:"/ja/home/database-management/snapshotting"},next:{title:"Updating Typescript Bindings",permalink:"/ja/home/database-management/ts-bindings"}},d={},c=[];function l(e){const a={a:"a",br:"br",code:"code",em:"em",h1:"h1",p:"p",pre:"pre",strong:"strong",...(0,s.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.h1,{id:"data-migrations",children:"Data Migrations"}),"\n",(0,t.jsx)(a.p,{children:"Data Migrations allow game developers to add data to the database e.g., World Setup, NPC, Items, and other system tables."}),"\n",(0,t.jsxs)(a.p,{children:[(0,t.jsx)(a.em,{children:"IMPORTANT"}),": You should never add data to the database manually. It should be done only through state-transitions and data migrations."]}),"\n",(0,t.jsxs)(a.p,{children:["Data Migrations are applied at a specific block-height. The file name indicates the ",(0,t.jsx)(a.code,{children:"OFFSET"})," from the ",(0,t.jsx)(a.code,{children:"START_BLOCKHEIGHT"})," (defined in the .env file - see ",(0,t.jsx)(a.a,{href:"/ja/home/setup/environment-config-values",children:"here"}),")."]}),"\n",(0,t.jsx)(a.p,{children:"File structure:"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{children:"root_folder\n   | --- paima-engine-{linux|macos}\n   | --- packaged\n             | --- endpoints.cjs\n             | --- gameCode.cjs\n             | --- migrations\n                          | --- 1000.sql\n                          | --- 5500.sql\n"})}),"\n",(0,t.jsxs)(a.p,{children:[(0,t.jsx)(a.code,{children:"1000.sql"})," will be applied at block-height ",(0,t.jsx)(a.code,{children:"START_BLOCKHEIGHT + 1000"}),".",(0,t.jsx)(a.br,{}),"\n",(0,t.jsx)(a.code,{children:"5500.sql"})," will be applied at block-height ",(0,t.jsx)(a.code,{children:"START_BLOCKHEIGHT + 5500"}),".",(0,t.jsx)(a.br,{}),"\n","Both will be applied before any other inputs are processed for that block-height."]}),"\n",(0,t.jsxs)(a.p,{children:["The *.sql files are PGSQL scripts. SQL scripts are automatically ran as transactions (no need for ",(0,t.jsx)(a.code,{children:"BEGIN"})," and ",(0,t.jsx)(a.code,{children:"END"}),"), and if they fail the block-process-loop will stop and the script must be fixed and will be reapplied."]}),"\n",(0,t.jsxs)(a.p,{children:[(0,t.jsx)(a.code,{children:"1000.sql"})," example:"]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-sql",children:"INSERT INTO items (name) VALUES ('potion') ;\nINSERT INTO items (name) VALUES ('book') ;\n"})}),"\n",(0,t.jsxs)(a.p,{children:[(0,t.jsx)(a.strong,{children:"Important"}),": migrations are included as part of your packaged node when you run ",(0,t.jsx)(a.code,{children:"npm run pack"}),". That means that you must re-run ",(0,t.jsx)(a.code,{children:"npm run pack"})," to have any changes you make to your migrations have any effect."]})]})}function m(e={}){const{wrapper:a}={...(0,s.a)(),...e.components};return a?(0,t.jsx)(a,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},1151:(e,a,n)=>{n.d(a,{Z:()=>r,a:()=>o});var t=n(7294);const s={},i=t.createContext(s);function o(e){const a=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function r(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(i.Provider,{value:a},e.children)}}}]);