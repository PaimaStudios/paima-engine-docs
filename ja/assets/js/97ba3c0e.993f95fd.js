"use strict";(self.webpackChunkpaima_engine_docs=self.webpackChunkpaima_engine_docs||[]).push([[6303],{751:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>d});var l=t(5893),s=t(1151);const a={},i="Effect on Interfaces",r={id:"home/multichain-support/wallet-layer/delegate-wallet/interfaces",title:"Effect on Interfaces",description:"Enabling wallet delegation has implications on the interfaces of multiple different parts of your application.",source:"@site/docs/home/700-multichain-support/2-wallet-layer/100-delegate-wallet/3-interfaces.mdx",sourceDirName:"home/700-multichain-support/2-wallet-layer/100-delegate-wallet",slug:"/home/multichain-support/wallet-layer/delegate-wallet/interfaces",permalink:"/ja/home/multichain-support/wallet-layer/delegate-wallet/interfaces",draft:!1,unlisted:!1,editUrl:"https://github.com/PaimaStudios/paima-engine-docs/tree/main/docs/home/700-multichain-support/2-wallet-layer/100-delegate-wallet/3-interfaces.mdx",tags:[],version:"current",sidebarPosition:3,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Introduction",permalink:"/ja/home/multichain-support/wallet-layer/delegate-wallet/introduction"},next:{title:"Integrate into your game",permalink:"/ja/home/multichain-support/wallet-layer/delegate-wallet/integrate"}},o={},d=[{value:"Meta Primitive",id:"meta-primitive",level:2},{value:"STF",id:"stf",level:2},{value:"Indexer Database",id:"indexer-database",level:2},{value:"Middleware",id:"middleware",level:2},{value:"Connect two wallets",id:"connect-two-wallets",level:3},{value:"Cancel delegation",id:"cancel-delegation",level:3},{value:"Migrate wallet",id:"migrate-wallet",level:3},{value:"Helper",id:"helper",level:3}];function c(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.a)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h1,{id:"effect-on-interfaces",children:"Effect on Interfaces"}),"\n",(0,l.jsx)(n.p,{children:"Enabling wallet delegation has implications on the interfaces of multiple different parts of your application."}),"\n",(0,l.jsx)(n.h2,{id:"meta-primitive",children:"Meta Primitive"}),"\n",(0,l.jsxs)(n.p,{children:["The user must (using a ",(0,l.jsx)(n.a,{href:"/ja/home/state-machine/define-machine/base-format",children:"concise"})," command) send a transaction to delegate their wallet address to another wallet address"]}),"\n",(0,l.jsxs)(n.p,{children:["Wallet delegation provides the following ",(0,l.jsx)(n.a,{href:"/ja/home/state-machine/react-to-events/primitive-catalogue/meta/introduction",children:"meta primitives"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"    delegate            =   &wd|from?|to?|from_signature|to_signature\n    migrate             =   &wm|from?|to?|from_signature|to_signature\n    cancelDelegations   =   &wc|to?\n"})}),"\n",(0,l.jsx)(n.h2,{id:"stf",children:"STF"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.a,{href:"/ja/home/state-machine/define-machine/read-data#stf-function",children:"STF"})," data is slightly changed:"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"userAddress"}),": contains the main wallet address."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"realAddress"}),": contains the real wallet address that sent the transaction."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"userId"}),": contains the user id, which is the same for all wallets of the same user."]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"userAddress"})," and ",(0,l.jsx)(n.code,{children:"realAddress"})," will be the same for the main wallet or if there are no delegations."]}),"\n",(0,l.jsx)(n.h2,{id:"indexer-database",children:"Indexer Database"}),"\n",(0,l.jsx)(n.p,{children:"There are 2 tables tracked in the indexer to manage delegations:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"addresses"}),": ",(0,l.jsx)(n.em,{children:"(always present)"})," maps a unique user id to each wallet address."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"delegations"}),": ",(0,l.jsx)(n.em,{children:"(new for delegations)"})," maps delegated wallet addresses using IDs from the ",(0,l.jsx)(n.em,{children:"addresses"})," table."]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"middleware",children:"Middleware"}),"\n",(0,l.jsxs)(n.p,{children:["There are multiple files part of ",(0,l.jsx)(n.code,{children:"@paima/sdk/mw-core"})," to help integrate wallet delegation"]}),"\n",(0,l.jsx)(n.h3,{id:"connect-two-wallets",children:"Connect two wallets"}),"\n",(0,l.jsxs)(n.p,{children:["This function delegates ",(0,l.jsx)(n.code,{children:"from"})," your main wallet ",(0,l.jsx)(n.code,{children:"to"})," your burner wallet"]}),"\n",(0,l.jsxs)(n.p,{children:["When delegating, you must sign the following message template in 2 steps: once for each key (",(0,l.jsx)(n.code,{children:"from"})," key & ",(0,l.jsx)(n.code,{children:"to"})," key):"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"DELEGATE-WALLET:<other-address-lowercase>\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["The previous plaintext message can be generated with the builtin helper: ",(0,l.jsx)(n.code,{children:"WalletConnectHelper.buildMessageToSign(other-address-lowercase)"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"other-address-lowercase"}),": the address not signing this step"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.em,{children:"Note:"})," the address signing for a given step is not explicitly added since its address & signature are implicitly part of the transaction"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:"function walletConnect(\n  // If from/to are null\n  // they gets replaced by the wallet that sends (or signs if using the batcher) the tx\n  from: string | null,\n  to: string | null,\n  from_signature: string,\n  to_signature: string\n): Promise<SuccessfulResult<PostDataResponse> | FailedResult>\n"})}),"\n",(0,l.jsx)(n.h3,{id:"cancel-delegation",children:"Cancel delegation"}),"\n",(0,l.jsxs)(n.p,{children:["This function removes any current delegation to the sender address.\nIf ",(0,l.jsx)(n.code,{children:"to"})," is an empty string, it will remove all delegations.\nIf ",(0,l.jsx)(n.code,{children:"to"})," is a valid address, it will remove the delegation to that single address."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:"function walletConnectCancelDelegations(\n  to: string\n): Promise<SuccessfulResult<PostDataResponse> | FailedResult>\n"})}),"\n",(0,l.jsx)(n.h3,{id:"migrate-wallet",children:"Migrate wallet"}),"\n",(0,l.jsxs)(n.p,{children:["This function migrates the address ",(0,l.jsx)(n.code,{children:"from"})," to ",(0,l.jsx)(n.code,{children:"to"}),"."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:"function walletConnectMigrate(\n  // null gets replaced by the wallet that signs the tx\n  from: string | null,\n  to: string | null,\n  from_signature: string,\n  to_signature: string\n): Promise<SuccessfulResult<PostDataResponse> | FailedResult> \n"})}),"\n",(0,l.jsx)(n.h3,{id:"helper",children:"Helper"}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"WalletConnectHelper"})," class contains helper functions to sign with injected or generate the message for local wallets:"]}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"buildMessageToSign"})," to generate the correct concise notation to sign for an action"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"connectExternalWalletAndSign"})," to connect an external wallet and delegate from it at the same time."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>r,a:()=>i});var l=t(7294);const s={},a=l.createContext(s);function i(e){const n=l.useContext(a);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),l.createElement(a.Provider,{value:n},e.children)}}}]);