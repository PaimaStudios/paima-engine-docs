"use strict";(self.webpackChunkpaima_engine_docs=self.webpackChunkpaima_engine_docs||[]).push([[479],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>m});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),p=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},d=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),u=p(a),m=r,h=u["".concat(l,".").concat(m)]||u[m]||c[m]||i;return a?n.createElement(h,o(o({ref:t},d),{},{components:a})):n.createElement(h,o({ref:t},d))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var p=2;p<i;p++)o[p]=a[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},7610:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));const i={sidebar_position:5},o="Batched mode",s={unversionedId:"home/Read & Write L2 State/batched-mode",id:"home/Read & Write L2 State/batched-mode",title:"Batched mode",description:"Paima supports two different modes for inputs:",source:"@site/docs/home/2 - Read & Write L2 State/5 - batched-mode.md",sourceDirName:"home/2 - Read & Write L2 State",slug:"/home/Read & Write L2 State/batched-mode",permalink:"/ja/home/Read & Write L2 State/batched-mode",draft:!1,editUrl:"https://github.com/PaimaStudios/paima-engine-docs/docs/home/2 - Read & Write L2 State/5 - batched-mode.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Posting Test Game Inputs To L2 Contract",permalink:"/ja/home/Read & Write L2 State/posting-test-game-inputs"},next:{title:"Replay protection",permalink:"/ja/home/Read & Write L2 State/replay-protection"}},l={},p=[{value:"Paima Engine Support",id:"paima-engine-support",level:2},{value:"Batched Input Format",id:"batched-input-format",level:2}],d={toc:p};function c(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"batched-mode"},"Batched mode"),(0,r.kt)("p",null,"Paima supports two different modes for inputs:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Non-batched mode. This only supports EVM wallets set to the same network as used for the settlement layer of the app. Transaction are submitted directly by the user (and they cover the transaction fees)"),(0,r.kt)("li",{parentName:"ol"},"Batched mode. Users sign data, and transactions are crafted by the batcher. This allows users to use the app with different EVM networks or wallets from different cryptocurrencies.")),(0,r.kt)("p",null,"We protect batched mode users by calculating ",(0,r.kt)("inlineCode",{parentName:"p"},"sign(securityPrefix || input || timestamp)")," where:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"securityPrefix")," is described ",(0,r.kt)("a",{parentName:"li",href:"/ja/home/Read%20&%20Write%20L2%20State/autosign"},"here")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"timestamp")," is used for replay protection. You can learn more about replay protection ",(0,r.kt)("a",{parentName:"li",href:"/ja/home/Read%20&%20Write%20L2%20State/replay-protection"},"here"))),(0,r.kt)("p",null,"The idea behind it is that rather than each user submitting their own transactions directly on-chain, instead they:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Create a valid game input."),(0,r.kt)("li",{parentName:"ol"},"Sign the payload with their private key."),(0,r.kt)("li",{parentName:"ol"},"Provide the game input + signature + their address to a batcher."),(0,r.kt)("li",{parentName:"ol"},'The batcher compiles the signed game inputs of many users and submits one "batched game input" transaction the contract.')),(0,r.kt)("h2",{id:"paima-engine-support"},"Paima Engine Support"),(0,r.kt)("p",null,"One of the great things about game input batching is that we can support it on the level of Paima Engine such that every game will be able to automatically get to take advantage of it for free. Furthermore, the implementer of a game state machine does not even have to consider batched game inputs (besides the fact that address types may vary if supporting other L1s)."),(0,r.kt)("p",null,"Specifically, Paima Funnel will handle unbundling the batch for you so that each entry inside the batch will be treated as if it was an individual input from the perspective of your app (technically speaking, the single ",(0,r.kt)("inlineCode",{parentName:"p"},"submittedData")," that contains the entire batch will be split such that each entry inside the batch will be its own ",(0,r.kt)("inlineCode",{parentName:"p"},"submittedData"),")."),(0,r.kt)("p",null,"In order for this to be secure, while processing a batched game input transaction Paima Funnel verifies every signature matches for every game input supplied. If not, then that game input is thrown away. As such, when constructing a ",(0,r.kt)("inlineCode",{parentName:"p"},"submittedData"),", the address will be verified and can be trusted if they end up inside your app (of note, in regular submitted game input this signature validation is performed by the blockchain validators who verified the tx before it was added to a block, so now we have to do it instead). Thus the game state machine will be able to trust the authenticity of all ",(0,r.kt)("inlineCode",{parentName:"p"},"submittedData"),", whether or not they came from batched game input txs, and not have to even consider how they were submitted."),(0,r.kt)("h2",{id:"batched-input-format"},"Batched Input Format"),(0,r.kt)("p",null,"We will specify a standard batched input transactions are required to follow in order to be considered valid."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"B~\nuserAddress/userSignature/input/millisecondTimestamp~\nuserAddress/userSignature/input/millisecondTimestamp~\nuserAddress/userSignature/input/millisecondTimestamp~\n")),(0,r.kt)("p",null,"Key notes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"B")," is used to denote this is a batched game input transaction. It is simply the ASCII character ",(0,r.kt)("inlineCode",{parentName:"li"},"B"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"~")," in practice is actually the ",(0,r.kt)("inlineCode",{parentName:"li"},"\\x02")," ASCII character"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"/")," in practice is actually the ",(0,r.kt)("inlineCode",{parentName:"li"},"\\x03")," ASCII character")))}c.isMDXComponent=!0}}]);